#+TITLE: ABC 389, =Justfile=, ç«¶ãƒ—ãƒ­ç›†æ ½.hs
#+DATE: <2025-01-19 Sun>

* ABC 389

[[https://atcoder.jp/contests/abc389][ABC 389]] ã«å‚åŠ ã—ã¾ã—ãŸã€‚å¾ŒåŠã¯é«˜ diff äºŒåˆ†æ¢ç´¢ã®è‰¯å•ã ã£ãŸæ¨¡æ§˜ã§ã™ã€‚

#+CAPTION: Diff äºˆæƒ³
| å•é¡Œ       | A å•é¡Œ | B å•é¡Œ | C å•é¡Œ | D å•é¡Œ | E å•é¡Œ | F å•é¡Œ |
|------------+--------+--------+--------+--------+--------+--------|
| æå‡º       |     AC |     AC |     AC |     AC | -      | -      |
| ä½“æ„Ÿ diff |     10 |    100 |    400 |    600 | 1,200  | 1,600  |
| å®Ÿéš› diff |      8 |     25 |    255 |    749 | 1,897  | 1,642  |

** [[https://atcoder.jp/contests/abc389/tasks/abc389_a][A å•é¡Œ]]

æ–‡å­—åˆ— =AxB= ãŒä¸ãˆã‚‰ã‚ŒãŸã¨ãã€ =A * B= ã‚’è¨ˆç®—ã›ã‚ˆã€‚ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã—ã¾ã™:

#+BEGIN_SRC haskell
solve :: StateT BS.ByteString IO ()
solve = do
  [!a, !_, !b] <- BS.unpack <$> line'
  printBSB $ digitToInt a * digitToInt b
#+END_SRC

** [[https://atcoder.jp/contests/abc389/tasks/abc389_b][B å•é¡Œ]]

æ•´æ•° $X$ ãŒä¸ãˆã‚‰ã‚Œã¨ãã€ $N! = X$ ã¨ãªã‚‹ $N$ ã‚’æ±‚ã‚ã‚ˆã€‚é…å»¶è©•ä¾¡ã®å‡ºç•ªã§ã™:

#+BEGIN_SRC haskell
solve :: StateT BS.ByteString IO ()
solve = do
  !x <- int'
  printBSB $ fromJust $ elemIndex x $ scanl' (*) (1 :: Int) [1..]
#+END_SRC

** [[https://atcoder.jp/contests/abc389/tasks/abc389_c][C å•é¡Œ]]

ã‚­ãƒ¥ãƒ¼ã«è¦ç´ è¿½åŠ ãƒ»å‰Šé™¤ã—ã¦ã„ãæ™‚ã€ã‚­ãƒ¥ãƒ¼ã®ä¸­ã§ $k - 1$ ç•ªç›®ã®è¦ç´ ã®ç´¯ç©å’Œã‚’æ±‚ã‚ã‚ˆã€‚å…ˆã«å…¨è¦ç´ ã®ç´¯ç©å’Œé…åˆ—ã‚’ä½œã£ã¦ãŠã‘ã°ã€ pop å›æ•° $\mathrm{nPop}$ ã‚’ç”¨ã„ã¦ $S[k + \mathrm{nPop}] - S[\mathrm{nPop}]$ ãŒç­”ãˆã«ãªã‚Šã¾ã™ã€‚

ã¾ãšã‚¯ã‚¨ãƒªã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¾ã™:

#+BEGIN_SRC haskell
solve :: StateT BS.ByteString IO ()
solve = do
  !q <- int'
  !qs <-
    U.replicateM q $
      int' >>= \case
        1 -> (1 :: Int,) <$> int'
        2 -> pure (2 :: Int, -1)
        3 -> (3 :: Int,) <$> int'
        _ -> error "unreachable"
#+END_SRC

Push ã‚¯ã‚¨ãƒªã‚’å…ˆèª­ã¿ã—ã€ç´¯ç©å’Œé…åˆ—ã‚’ä½œã‚Šã¾ã™:

#+BEGIN_SRC haskell
  let (!spawns, !other) = U.partition ((== 1) . fst) qs
  let pos = dbgId $ U.scanl' (+) (0 :: Int) $ U.map snd spawns
#+END_SRC

=unfoldr= ã§ã‚¯ã‚¨ãƒª =3= ã®ç­”ãˆã‚’ä½œã‚Šã¾ã™:

#+BEGIN_SRC haskell
  let res = U.unfoldr f (0 :: Int, other)
        where
          f :: (Int, U.Vector (Int, Int)) -> Maybe (Int, (Int, U.Vector (Int, Int)))
          f (!nPop, !qs_) = do
            (!q, !rest) <- U.uncons qs_
            case q of
              (1, !_) -> f (nPop, rest)
              (2, !_) -> f (nPop + 1, rest)
              (3, pred -> k) -> pure (pos G.! (k + nPop) - pos G.! nPop, (nPop, rest))

  printBSB $ unlinesBSB res
#+END_SRC

** [[https://atcoder.jp/contests/abc389/tasks/abc389_d][D å•é¡Œ]]

åŠå¾„ $r$ ã®å††ã«å†…åŒ…ã•ã‚Œã‚‹æ­£æ–¹å½¢ã®æ•°ã‚’æ•°ãˆã‚ˆã€‚ç¬¬ä¸€è±¡é™ ($Q_1 = \{ (x, y) \mid x > 0, y > 0 \}$) ä¸­ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’ 4 å€ã—ã€ X, Y è»¸ä¸Šã®æ­£æ–¹å½¢ã®æ•°ã‚’è¶³ã™ã¨ç­”ãˆã«ãªã‚Šã¾ã™ã€‚è¡Œã”ã¨ã«å³ç«¯ã®æ­£æ–¹å½¢ã®ä½ç½®ã‚’äºŒåˆ†æ¢ç´¢ã™ã‚Œã°ã€ $O(r \log r)$ ã§è§£ç­”ã§ãã¾ã™ã€‚

#+BEGIN_SRC haskell
-- | æ­£æ–¹å½¢ã® 4 ç‚¹ã¨åŸç‚¹ã®é–“ã®è·é›¢ãŒ r ä»¥ä¸‹ãªã‚‰ã° true
testPoint :: Int -> Int -> Int -> Bool
testPoint r y x = all (<= 4 * r * r) [d1, d2, d3, d4]
  where
    y2 = 2 * y + 1
    y1 = 2 * y - 1
    x2 = 2 * x + 1
    x1 = 2 * x - 1
    dist a b = a * a + b * b
    d1 = dist y1 x1
    d2 = dist y1 x2
    d3 = dist y2 x1
    d4 = dist y2 x2

-- | è¡Œã‚’ã‚«ã‚¦ãƒ³ãƒˆ
solveRow :: Int -> Int -> Int
solveRow r y = fromMaybe 0 $ bisectL 0 r $ \x -> testPoint r y x

-- | å››åˆ†å††ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
solveQuater :: Int -> Int
solveQuater r = sum [solveRow r y | y <- [1 .. r + 1]]

-- | å††å…¨ä½“ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
f :: Int -> Int
f r = solveQuater r * 4 + 4 * (r - 1) + 1

solve :: StateT BS.ByteString IO ()
solve = do
  !r <- int'
  printBSB $ f r
#+END_SRC

** [[https://atcoder.jp/contests/abc389/tasks/abc389_e][E å•é¡Œ]]

é ‘å¼µã£ã¦è§£èª¬ AC ã™ã‚‹ã‹ã‚‚â€¦â€¦ï¼Ÿ

** [[https://atcoder.jp/contests/abc389/tasks/abc389_f][F å•é¡Œ]]

é ‘å¼µã£ã¦è§£èª¬ AC ã™ã‚‹ã‹ã‚‚â€¦â€¦ï¼Ÿ

* Misc

** just

[[https://toyboot4e.github.io/2025-01-18-task-runners.html][ãŠè©¦ã—ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼]] ã®å¾Œã€ =ac-library-hs= ã« =Justfile= ã‚’å°å…¥ã—ã¾ã—ãŸ [[https://github.com/toyboot4e/ac-library-hs/commit/d74035fb2528c65a41833d1d8e7d61ec48558174][(è©²å½“ã®ã‚³ãƒŸãƒƒãƒˆ)]] ã€‚ã“ã‚ŒãŒçµæ§‹è‰¯ã„æ„Ÿã˜ã§ã™ã€‚æ›¸ãå‘³è‰¯ã—ã€è¦‹ãŸç›®è‰¯ã—ï¼:

#+CAPTION: =Justfile= ã®ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§
[[./img/2025-01-19-just.png]]

#+CAPTION: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ä¾‹
#+BEGIN_SRC sh
$ j t # ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã‚‚å®Ÿè¡Œå¯
#+END_SRC

ABC ç’°å¢ƒã«ã‚‚å°å…¥ã—ã¾ã—ãŸ ([[https://github.com/toyboot4e/abc-hs/commit/215a58db27301d2ec61c7fecf1ccce60b8c1553b][è©²å½“ã®ã‚³ãƒŸãƒƒãƒˆ]]) ã€‚ãƒªãƒã‚¸ãƒˆãƒªæ¯ã«ç°¡æ½”ãªã‚³ãƒãƒ³ãƒ‰ãƒ¬ã‚·ãƒ”ã‚’æŒã¦ã‚‹ã‚ˆã†ã«ãªã‚Šã€è¦‹é€šã—ãŒè‰¯ããªã£ãŸã¨æ€ã„ã¾ã™ã€‚

=just= ã®è§£èª¬ã¯ [[https://minerva.mamansoft.net/Notes/%F0%9F%93%9C%E3%82%BF%E3%82%B9%E3%82%AF%E3%83%A9%E3%83%B3%E3%83%8A%E3%83%BC%E3%81%AEjust%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F][ğŸ“œã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã®justã‚’è©¦ã—ã¦ã¿ãŸ - Minerva]] ãŒè‰¯ã„ã§ã™ã€‚ [[https://blog.tomoya.dev/][tomoya ã•ã‚“ã®ãƒ–ãƒ­ã‚°]] ã¨åŒç³»çµ±ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§ã€ãƒšãƒ¼ã‚¸ã‚‚æ ¼å¥½ã„ã„ã€‚

** è¨€èªã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ 2025

[[https://github.com/haskell-hvr/cabal-plan][=cabal-plan=]] ã® =license-report= ãŠã‚ˆã³ gksato ã•ã‚“ã® [[https://github.com/gksato/haskell-atcoder-server-gen][server gen]] ã®ãŠã‹ã’ã§ã€ç‰¹ã«å•é¡Œç„¡ãæ›´æ–°ã§ããã†ã§ã™ã€‚æœ€æ‚ªã€ 10 åˆ†ã‚ã‚Œã°ä»Šã™ãã«æ›´æ–°ã‚’ç”³è«‹ã§ãã¾ã™ã€‚è‰¯ã‹ã£ãŸã€œã€œï¼

æœªã å¤©ä¸‹ã® C++, Python ã®æ›´æ–°ç”³è«‹ãŒç„¡ã„ã®ã§ã€æ–°ã‚¸ãƒ£ãƒƒã‚¸ç’°å¢ƒã®ãƒ†ã‚¹ãƒˆã¯ 2 æœˆã«ãªã‚‹ã¨äºˆæƒ³ã—ã¦ã„ã¾ã™ã€‚ä»ŠæŒ¯ã‚Šè¿”ã‚‹ã¨ã€ [[https://github.com/toyboot4e/ac-library-hs][=ac-library-hs=]] ã‚’ä½œã‚Šå§‹ã‚ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚° (æ˜¨å¹´ 10 æœˆ) ã¯ã€ã¡ã‚‡ã†ã©ååˆ†ãªæ™‚é–“ãŒå¾—ã‚‰ã‚Œã¦è‰¯ã‹ã£ãŸã¨æ€ã„ã¾ã™ã€‚åäºŒåˆ†ã«ãƒãƒƒãƒ•ã‚¡ã‚’å–ã£ãŸã¤ã‚‚ã‚Šã§ã—ãŸãŒã€ãƒ†ã‚¹ãƒˆãŒé‡ã‹ã£ãŸã§ã™ã€‚

** ç«¶ãƒ—ãƒ­ç›†æ ½.hs

=ac-library-hs= é–‹ç™ºã¯ [[https://zenn.dev/toyboot4e/books/kyopro-bonsai-hs][ç«¶ãƒ—ãƒ­ç›†æ ½.hs]] ã«è¼‰ã›ã¦ã„ã¾ã™ã€‚ç›´å‰ã¾ã§ =ac-library-hs= ã‚’å¼„ã£ã¦ãŠã‚Šã€å®Ÿã¯ã»ã¼ 3 æ—¥ã§æ›¸ãã¾ã—ãŸã€‚ãƒ–ãƒ­ã‚°æ›¿ã‚ã‚Šã® [[https://github.com/toyboot4e/ac-library-hs/issues?q=is%3Aissue%20][Issue]] ã‚’ä¸‹æ•·ãã«ã—ãŸã®ãŒè‰¯ã‹ã£ãŸã§ã™ã€‚

ç«¶ãƒ—ãƒ­ç›†æ ½.hs ã¯åŠåˆ†ä»¥ä¸Šãƒ†ã‚¹ãƒˆã®è©±ã§ã™ã€‚ä½•ã¨è¨€ã£ã¦ã‚‚ QuickCheck ãŒå¤§æ´»èºã—ã¾ã—ãŸã€‚ã‚µã‚¯ã£ã¨ä¹±æ•°ç”Ÿæˆã—ã¦ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’ç¢ºèªã§ãã‚‹ã®ãŒå¬‰ã—ã„ã€‚è¦æ‰€ã®ãƒã‚°ã‚’æ—©æœŸç¢ºèªã§ãã‚‹ã®ã¯ã‚‚ã¡ã‚ã‚“ã€å˜ä½å…ƒã‚„ãƒ¢ãƒã‚¤ãƒ‰å‰‡ã®ã‚ˆã†ã«æ˜ã‚‰ã‹ã«é‡è¦ãªæ³•å‰‡ãŒã‚ã‚‹å ´åˆã¯åŠ¹æœæŠœç¾¤ã§ã™ã€‚

æ°—ãŒæ—©ã„ã§ã™ãŒã€ä»Šå¹´ã‚‚ Haskell ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ä½•ã‹å‡ºã—ãŸã„æ°—ã¯ã—ã¾ã™ã€‚é †å½“ã«è¡Œããªã‚‰ã€ Heuristic ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã§ã©ã‚Œã ã‘æˆ¦ãˆã‚‹ã‹ã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã€‚ Heuristic ã®èƒ½åŠ›ã‚’ç£¨ãã®ã¯ç›¸å½“ã—ã‚“ã©ã„ã¯ãšã§ã™ãŒã€ CTF ã‚ˆã‚Šã¯ãƒã‚·ã§ã™ã€‚ã‚„ã£ã¦ã„ãã®ã‹â€¦â€¦ï¼Ÿï¼Ÿ

